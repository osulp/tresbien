<div class="container show">
  <h2 class="mb-4">Reimbursement request</h2>

  <div class="row">
    <div class="col-12">
      <h3>Request Information:</h3>
      <p><strong>Status: </strong><span class="badge <%=@reimbursement_request.status %>"><%= @reimbursement_request.status.titlecase %></span></p>
      <p><strong>Claimant: </strong><%= @reimbursement_request.claimant.full_name %></p>
      <p><strong>Certifier: </strong><%= @reimbursement_request.certifier.full_name %></p>
      <p><strong>Description: </strong><%= @reimbursement_request.description %></p>
      <p><strong>Business Notes and Purpose: </strong><%= @reimbursement_request.business_notes_and_purpose %></p>

    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <%= render partial: "show_table", locals: {title: "Cities", attributes: ["from_date", "to_date", "state", "city", "hotel_rate"], objects: @reimbursement_request.travel_cities, id: "travel-cities" } %>

      <%= render partial: "show_table", locals: {title: "Daily Itineraries", attributes: ["date", "state", "city", "break", "lunch", "dinner", "hotel", "amount"], objects: @reimbursement_request.travel_itineraries, id: "travel-itineraries"  }%>

    </div>
  </div>

  <%= render partial: "show_table", locals: {
    title: "Other Expenses",
    attributes: ["expense_type", "from_date", "to_date", "notes", "amount"],
    objects: @reimbursement_request.expense_others,
    id: "expense-airfares",
    functions: {"expense_type" => lambda do |expense_other|
      expense_type = ExpenseType.find(expense_other.expense_type_id) if expense_other.expense_type_id
      return (expense_type ? expense_type.name : "")
    end  } } %>

  <%= render partial: "show_table", locals: {title: "Auto Mileage", attributes: ["from_date", "to_date", "from_state", "from_city", "to_state", "to_city", "miles", "notes", "amount"], objects: @reimbursement_request.expense_mileages, id: "expense_mileages" } %>

  <%= render partial: "show_table", locals: {title: "Airfare", attributes: ["from_date", "to_date", "from_location", "to_location", "notes", "amount"], objects: @reimbursement_request.expense_airfares, id: "expense-airfares" } %>


  <%= render partial: "show_table", locals: {title: "Accounting", attributes: ["index", "fund", "organization", "account", "program", "activity", "amount"], objects: @reimbursement_request.accountings, id: "accountings" } %>

  <div class="row">
    <div class="col-12">
      <h3>Attachments:</h3>
      <% if @reimbursement_request.children.count > 0 %>
        <% @reimbursement_request.children.each do |child| %>
          <%= link_to (image_tag child.attachment.url(:thumb) ), child.attachment.url, target: :_blank %>
        <% end %>
      <% else %>
        <p>No attachments</p>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <h3>Total: <%= @reimbursement_request.grand_total %></h3>
    </div>
  </div>
  <div class="row print-hide">
    <div class="col-4 d-flex justify-content-between">
      <h3 class="align-self-center">Update Form:</h3>
      <div>
        <%= link_to "Edit", edit_reimbursement_request_path(@reimbursement_request.id), class: "btn btn-primary edit-btn btn-lg align-self-center"%>
        <%= link_to "Print", reimbursement_request_path(@reimbursement_request.id, format: :pdf), class: "btn btn-success btn-lg align-self-center" %>
      </div>
    </div>
  </div>
  <%= render partial: "change_status_form" if @reimbursement_request.certifier_id == current_user.id %>
  <hr class="my-4 print-hide">
  <%= render 'status_comment'%>
</div>
